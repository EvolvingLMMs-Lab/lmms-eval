"""
ROVER Evaluation Prompts

Prompts for evaluating:
- reasoning_process: Quality of reasoning text (think_output)
- reasoning_visual: Quality of generated images
- reasoning_alignment: Alignment between reasoning text and generated images
"""

# =============================================================================
# Reasoning Process Prompts (评估推理过程文本质量)
# =============================================================================

REASONING_PROCESS_TEMPLATE = """
You are a professional AI evaluation specialist with expertise in {reasoning_type} reasoning assessment.

You will be given:
1. **Original Image**: the starting point
2. **Task Instruction**: the {reasoning_type} reasoning task to perform
3. **Dimension**: the knowledge domain (science/humanity/common_sense/logic)
4. **Keywords**: relevant domain concepts and principles for this task
5. **Target Description**: expected visual outcomes after {reasoning_type} reasoning
6. **Think Output**: the reasoning text generated by the model

Your Objective:
Evaluate ONLY the **actual text content** provided in the "Think Output" section. You must analyze the reasoning quality based solely on what is written there. Do NOT generate or evaluate your own reasoning - only assess the provided text.

CRITICAL: If the Think Output is empty, contains only placeholder text, or says "No think output available", you MUST give a score of 1 and explain that no actual reasoning was provided. Do NOT create your own reasoning to evaluate.

## Process Evaluation Criteria:
- **Logical Structure**: Is the reasoning well-organized and sequential?
- **Domain Knowledge**: Does the text show correct understanding of domain principles?
- **{reasoning_type_cap} Logic**: Does the reasoning follow correct {reasoning_type} causality?
- **Completeness**: Are all necessary reasoning steps included?

## Domain-Specific Considerations:
- **Science**: Apply scientific principles and natural laws; verify that reasoning follows established scientific facts and theories; reject unscientific claims or impossible phenomena
- **Humanity**: Consider cultural, historical, and social contexts; ensure reasoning respects cultural norms and historical accuracy; avoid cultural insensitivity or anachronisms
- **Common Sense**: Use everyday knowledge and practical understanding; verify reasoning aligns with real-world experience and logical expectations; reject unrealistic or impractical scenarios
- **Logic**: Follow formal reasoning and mathematical principles; ensure logical consistency and mathematical accuracy; reject logical fallacies or mathematical errors

## Evaluation Scale (1 to 5):
- **5 Perfect Process Logic**: All reasoning steps are logically sound, domain-accurate, and demonstrate complete mastery of the task requirements
- **4 High Quality Process**: Reasoning achieves 80-90%+ of requirements with only minor gaps or imperfections that don't affect core logic
- **3 Adequate Process**: Reasoning meets basic requirements (60-70%) but has noticeable flaws or missing important elements
- **2 Poor Process**: Reasoning has major logical errors or fails to address most requirements (30-50% achievement)
- **1 Failed Process**: Written reasoning is fundamentally flawed, missing, or completely off-track (<30% achievement)

## Input
**Original Image**
**Task Instruction**: {prompt}
**Dimension**: {dimension}
**Keywords**: {keywords}
**Target Description**: {target_description}
**Think Output**: {think_output}

## Output Format
{{
  "reasoning_process_score": X,
  "reasoning": "Your detailed evaluation following the criteria above"
}}
"""


# =============================================================================
# Reasoning Visual Prompts (评估视觉推理结果质量)
# =============================================================================

REASONING_VISUAL_TEMPLATE = """
You are a professional AI evaluation specialist with expertise in {reasoning_type} reasoning assessment.

You will be given:
1. **Original Image**: the starting point
2. **Generated Image**: the result after {reasoning_type} reasoning
3. **Task Instruction**: the {reasoning_type} reasoning task to perform
4. **Dimension**: the knowledge domain (science/humanity/common_sense/logic)
5. **Keywords**: relevant domain concepts and principles for this task
6. **Target Description**: expected visual outcomes after {reasoning_type} reasoning
7. **Target Image** (if available): reference image showing the expected result

Your Objective:
Evaluate whether the **generated image** matches the target description (and target image if available) and demonstrates correct {reasoning_type} reasoning. Focus on comparing the visual result with the expected outcomes.

## Visual {reasoning_type_cap} Logic Principles:
- **Sequential Progression**: Visual changes follow natural {reasoning_type} order
- **Causality**: Each visual stage logically leads to the next
- **Process Continuity**: No impossible visual jumps or missing critical stages
- **Consistency**: Visual changes match the specified requirements

## Domain-Specific Considerations:
- **Science**: Apply scientific principles and natural laws; verify that reasoning follows established scientific facts and theories; reject unscientific claims or impossible phenomena
- **Humanity**: Consider cultural, historical, and social contexts; ensure reasoning respects cultural norms and historical accuracy; avoid cultural insensitivity or anachronisms
- **Common Sense**: Use everyday knowledge and practical understanding; verify reasoning aligns with real-world experience and logical expectations; reject unrealistic or impractical scenarios
- **Logic**: Follow formal reasoning and mathematical principles; ensure logical consistency and mathematical accuracy; reject logical fallacies or mathematical errors

## Evaluation Steps:
1. **Target Match**: Does the generated image match the target description (and target image if available)?
2. **Visual Changes Analysis**: What has visually changed from original to generated image?
3. **Domain Knowledge Check**: Do visual changes align with keyword-related principles?
4. **{reasoning_type_cap} Logic Validation**: Is the visual progression {reasoning_type}ly sound?

## Evaluation Scale (1 to 5):
- **5 Perfect Target Match**: Generated image **precisely matches** target description with **flawless {reasoning_type} logic**; all required changes are present and accurate with **zero gaps or errors**
- **4 High Quality Match**: Generated image achieves 80-90%+ of target requirements with only minor details missing or slightly incorrect
- **3 Adequate Match**: Generated image meets basic requirements (60-70%) but has notable gaps, wrong aspects, or incomplete changes
- **2 Poor Match**: Generated image fails most target requirements (30-50% achievement) with major gaps or incorrect reasoning
- **1 Failed Match**: Generated image completely fails to match target or shows fundamental logic errors (<30% achievement)

## Input
**Image 1: Original Image** (the starting point)
**Image 2: Generated Image** (the result after {reasoning_type} reasoning)
**Image 3: Target Image** (if available, the reference showing expected result)
**Task Instruction**: {prompt}
**Dimension**: {dimension}
**Keywords**: {keywords}
**Target Description**: {target_description}

## Output Format
{{
  "reasoning_visual_score": X,
  "reasoning": "Your detailed evaluation following the criteria above"
}}
"""


# =============================================================================
# Reasoning Alignment Prompt (评估推理文本与生成图像的对齐度)
# =============================================================================

REASONING_ALIGNMENT_PROMPT = """
You are a professional AI evaluation specialist focusing on process-visual reasoning alignment assessment.

You will be given:
1. **Original Image**: the starting point
2. **Generated Image**: the reasoning result
3. **Task Instruction**: what reasoning should be performed
4. **Think Output**: the reasoning process text generated by the model

Your Objective:
Evaluate whether the **reasoning process text** and the **visual reasoning result** are aligned and consistent with each other. Focus on whether what the model thought and what the model visually produced match.

## Alignment Evaluation Criteria:
- **Process-Visual Consistency**: Do the written reasoning steps match the visual changes?
- **Conclusion Coherence**: Do text conclusions align with visual outcomes?
- **Step-by-Step Alignment**: Does each reasoning step in text correspond to visual evidence?
- **Logical Consistency**: Are there contradictions between thought process and visual result?

## Domain-Specific Considerations:
- **Science**: Apply scientific principles and natural laws; verify that reasoning follows established scientific facts and theories; reject unscientific claims or impossible phenomena
- **Humanity**: Consider cultural, historical, and social contexts; ensure reasoning respects cultural norms and historical accuracy; avoid cultural insensitivity or anachronisms
- **Common Sense**: Use everyday knowledge and practical understanding; verify reasoning aligns with real-world experience and logical expectations; reject unrealistic or impractical scenarios
- **Logic**: Follow formal reasoning and mathematical principles; ensure logical consistency and mathematical accuracy; reject logical fallacies or mathematical errors

## Key Questions:
1. **Does the visual result reflect the written reasoning?** Are the visual changes consistent with what was described in the think output?
2. **Are the conclusions aligned?** Do both process and visual reasoning reach the same conclusions?
3. **Is the reasoning coherent?** Are there contradictions between what was thought and what was visually produced?
4. **Is the task prompt correctly understood?** Do both the process text and visual result demonstrate correct understanding of what the task is asking for?

## Evaluation Scale (1 to 5):
- **5 Perfect Alignment**: Process text and visual result are **completely consistent** and mutually supporting with **zero contradictions**; all process claims match visual evidence exactly; AND both correctly understand and implement the task prompt
- **4 High Quality Alignment**: Process and visual achieve 80-90%+ alignment with only minor inconsistencies that don't affect core reasoning; AND both generally follow the task prompt correctly
- **3 Adequate Alignment**: Some alignment present (60-70%) but clear discrepancies between process and visual reasoning; notable inconsistencies exist; OR good internal alignment but significant misunderstanding of task prompt
- **2 Poor Alignment**: Minimal alignment (30-50%) with major contradictions between written process and visual result; significant mismatches; OR both process and visual fundamentally misunderstand the prompt
- **1 No Alignment**: Process text and visual result are contradictory or completely unrelated (<30% alignment); OR complete failure to understand task prompt

## CRITICAL ALIGNMENT CONSTRAINT:
**Alignment score cannot exceed visual reasoning score by more than 1 point.**
- If visual reasoning = 1, alignment can be at most 2
- If visual reasoning = 2, alignment can be at most 3
- If visual reasoning = 3, alignment can be at most 4
- If visual reasoning = 4-5, alignment can be 4-5

This ensures logical consistency: you cannot have high alignment with poor visual reasoning.

## Reasoning Steps:
1. **Extract Process Claims**: What does the think output claim will happen or should be done?
2. **Identify Visual Evidence**: What changes are actually visible in the generated image?
3. **Compare Alignment**: Do the process claims match the visual evidence?
4. **Assess Consistency**: Are there any contradictions between thought and visual result?

## Input
**Image 1: Original Image**
**Image 2: Generated Image**
**Task Instruction**: {prompt}
**Think Output**: {think_output}

## Output Format
{{
  "reasoning_alignment_score": X,
  "reasoning": "Your detailed evaluation following the criteria above"
}}
"""


# =============================================================================
# Helper Functions
# =============================================================================

def get_reasoning_process_prompt(
    reasoning_type: str,
    prompt: str,
    dimension: str,
    keywords: str,
    target_description: str,
    think_output: str,
) -> str:
    """Get reasoning process evaluation prompt for a specific reasoning type."""
    return REASONING_PROCESS_TEMPLATE.format(
        reasoning_type=reasoning_type,
        reasoning_type_cap=reasoning_type.capitalize(),
        prompt=prompt,
        dimension=dimension,
        keywords=keywords,
        target_description=target_description,
        think_output=think_output if think_output else "No think output available",
    )


def get_reasoning_visual_prompt(
    reasoning_type: str,
    prompt: str,
    dimension: str,
    keywords: str,
    target_description: str,
) -> str:
    """Get reasoning visual evaluation prompt for a specific reasoning type."""
    return REASONING_VISUAL_TEMPLATE.format(
        reasoning_type=reasoning_type,
        reasoning_type_cap=reasoning_type.capitalize(),
        prompt=prompt,
        dimension=dimension,
        keywords=keywords,
        target_description=target_description,
    )


def get_reasoning_alignment_prompt(
    prompt: str,
    think_output: str,
) -> str:
    """Get reasoning alignment evaluation prompt."""
    return REASONING_ALIGNMENT_PROMPT.format(
        prompt=prompt,
        think_output=think_output if think_output else "No think output available",
    )
